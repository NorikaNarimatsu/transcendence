services:
  backend_app:
    container_name: backend
    build:
      dockerfile: backend.Dockerfile
      context: backend/
    volumes:
      - ./backend:/app
      - backend_node_modules:/app/node_modules
      - backend_data:/app/src/database/db
      - ./backend/https:/app/https:ro
    ports:
      - "8443:8443"
    networks:
      - transcendence_network
    healthcheck:
      test: ["CMD", "curl", "-f", "-k", "https://localhost:8443/health"]
      interval: 5s
      timeout: 2s
      retries: 2

# https://github.com/vitejs/vite/discussions/15532
  frontend_app:
    container_name: frontend
    build:
      context: frontend/
      dockerfile: frontend.Dockerfile
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules
    networks:
      - transcendence_network
    depends_on:
      backend_app:
        condition: service_healthy

volumes:
  frontend_node_modules:
  backend_node_modules:
  backend_data:

networks:
  transcendence_network:
    name: transcendence_network
    driver: bridge


#old frontend setting
 # frontend_app:
  #   container_name: frontend
  #   build:
  #     dockerfile: frontend.Dockerfile
  #     context: frontend/
  #   ports:
  #     - "3000:3000"
  #   networks:
  #     - transcendence_network
  #   depends_on:
  #     backend_app:
  #       condition: service_healthy
